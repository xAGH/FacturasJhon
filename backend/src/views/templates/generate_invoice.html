{% extends "layout.html" %}
{% block title %}Generar Factura{% endblock %}

{% block content %}
{% if genPDF %}
  <script src="{{url_for('static', filename='js/html2pdf.js')}}"></script>
  <script>
    const element = `<style>tr:nth-child(even) {background-color: #F3F4F6;}</style><div style="display: grid; padding-left: 2.5rem;padding-right: 2.5rem; width: 100%; height: 100vh; grid-template-rows: repeat(4, minmax(0, 1fr)); gap: 0.25rem;"><div style="display: flex; justify-content: space-between; "><div style="display: flex; align-items: center; "><img style="padding-right: 2rem; height: 100%;" src="{{url_for('static', filename='assets/Painter.png')}}" alt=""><div style="display: flex; flex-direction: column;"><p style="font-size: 1.875rem;line-height: 2.25rem; ">Pinturas Jhon</p><p style="font-size: 0.875rem;line-height: 1.25rem;color: #000; opacity: 0.6;">Jhon Eider Giraldo Tobón</p><p style="font-size: 0.875rem;line-height: 1.25rem;color: #000; opacity: 0.6;">NIF/CIF 04762353L</p><p style="font-size: 0.875rem;line-height: 1.25rem;color: #000; opacity: 0.6;">Calle la florida 11 1A</p><p style="font-size: 0.875rem;line-height: 1.25rem;color: #000; opacity: 0.6;">48902 Barakaldo</p><p style="font-size: 0.875rem;line-height: 1.25rem;color: #000; opacity: 0.6;">+34 674535140</p><p style="font-size: 0.875rem;line-height: 1.25rem;color: #000; opacity: 0.6;">michaelgiraldo0509@hotmail.com</p></div></div><p style="font-size: 1.875rem;line-height: 2.25rem; text-align: right; align-self: center;">{{doc_type}}</p></div><div style="display: flex; justify-content: space-between; "><div style="display: flex; flex-direction: column; justify-content: center; "><p style="font-size: 1.25rem;line-height: 1.75rem; ">Factura a:</p><p style="color: #000; opacity: 0.6;">{{client_name}}</p><p style="color: #000; opacity: 0.6;">NIF/CIF {{client_document}}</p><p style="color: #000; opacity: 0.6;">{{client_address}}</p><p style="color: #000; opacity: 0.6;">+34 {{client_phone}}</p></div><div style="display: flex; flex-direction: column; justify-content: center; gap: 0.5rem; "><div style="display: flex; justify-content: space-between; gap: 5rem; "><p>Número de factura:</p><p style="color: #000; opacity: 0.6;">{{invoice_no}}</p></div><div style="display: flex; justify-content: space-between; gap: 5rem;"><p>Fecha de generacion:</p><p style="color: #000; opacity: 0.6;">{{date}}</p></div><div style="display: flex; justify-content: space-between; gap: 5rem;"><p>Vencimiento:</p><p style="color: #000; opacity: 0.6;">Vence al recibir</p></div></div></div><div style="grid-row: span 2 / span 2; "><table style="color: #6B7280; font-size: 0.875rem;line-height: 1.25rem; text-align: left; width: 100%; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); "><thead style="background-color: #F9FAFB; color: #374151; text-transform: uppercase; "><tr style="font-size: 1rem;line-height: 1.5rem; text-align: right; "><th scope="col" style="padding-top: 0.75rem;padding-bottom: 0.75rem; padding-left: 1.5rem;padding-right: 1.5rem; text-align: left; ">Concepto</th><th scope="col" style="padding-top: 0.75rem;padding-bottom: 0.75rem; padding-left: 1.5rem;padding-right: 1.5rem; ">Precio</th><th scope="col" style="padding-top: 0.75rem;padding-bottom: 0.75rem; padding-left: 1.5rem;padding-right: 1.5rem; ">Cantidad</th><th scope="col" style="padding-top: 0.75rem;padding-bottom: 0.75rem; padding-left: 1.5rem;padding-right: 1.5rem; ">Total</th></tr></thead><tbody>{% for work in works%}<tr style="text-align: right; border-bottom-width: 1px; "><th scope="row" style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; color: #111827; text-align: left; ">{{work["concept"]}}</th><td style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; ">€ {{work["price"]}}</td><td style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; ">{{work["quantity"]}}</td><td style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; ">€ {{work["total"]}}</td></tr>{% endfor %}<tr style="text-align: right; border-bottom-width: 1px; "><th></th><td></td><th style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; ">Subtotal</th><td style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; ">€ {{raw_payment}}</td></tr><tr style="text-align: right; border-bottom-width: 1px; "><td></td><td></td><th style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; ">IVA (21%)</th><td style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; ">€ {{iva}}</td></tr><tr style="text-align: right; border-bottom-width: 1px; "><td></td><td></td><th style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; color: #111827; font-size: 1.125rem;line-height: 1.75rem; ">Total</td><td style="padding-top: 1rem;padding-bottom: 1rem; padding-left: 1.5rem;padding-right: 1.5rem; color: #111827; font-size: 1.125rem;line-height: 1.75rem; ">€ {{total}}</td></tr></tbody></table></div></div>`;
    const options = {
          filename: '{{ invoice_no }}',
          html2canvas: { scale: 2 },
          margin: 1
      };
    html2pdf().set(options).from(element).save().then((res) => res);
    setTimeout(() => {
      window.location.replace("{{ url_for('invoices') }}");
    }, 1500);
  </script>
{% endif %}
<form action="{{ url_for('invoices') }}" method="post" class="grid grid-cols-[1fr_1.5fr] grid-rows-[90%_auto] h-[75vh] mt-10 gap-4">
  
  <div class="flex flex-col items-center justify-center px-20">
    <p class="text-xl mb-10 underline">Informacion del cliente:</p>
    <div class="bg-card p-5 pb-16 rounded-lg w-full">
      <div class="flex flex-col gap-1">
        <label for="actual_date">Fecha:</label>
        <input class="rounded-lg" type="date" name="date" id="date" name="date" value="{{ actual_date }}" max="{{ actual_date }}" required/>
      </div>
      <div class="flex flex-col gap-1">
        <label for="client_name">Nombre del cliente:</label>
        <input class="rounded-lg" type="text" id="client_name" name="client_name" placeholder="Ej. Juan" required maxlength="40"/>
      </div>
      <div class="flex flex-col gap-1">
        <label for="client_phone">Celular del cliente:</label>
        <input class="rounded-lg" type="tel" id="client_phone" name="client_phone" placeholder="Ej. 613 45 64 75" required maxlength="20"/>
      </div>
      <div class="flex flex-col gap-1">
        <label for="client_document">Documento del cliente:</label>
        <input class="rounded-lg" type="text" id="client_document" name="client_document" placeholder="Ej. 23444532D" required maxlength="20"/>
      </div>
      <div class="flex flex-col gap-1">
        <label for="client_address">Direccion del cliente:</label>
        <input class="rounded-lg" type="text" id="client_address" name="client_address" placeholder="Ej. Calle 23 # 23-55" required maxlength="100"/>
      </div>
    </div>
  </div>

  <div class="flex flex-col gap-2 justify-center items-center h-full">
    <p id="worksLbl" class="text-xl underline">Trabajos(1):</p>

    <div class="h-full w-[90%] overflow-auto flex-1 py-8 border-4 rounded-md">
      <div id="works" class="grid grid-cols-2 works-container flex-1">
        <div count="1" class="work-item">
          <label for="concept1">Concepto:</label>
          <input class="rounded-lg" type="text" id="concept1" name="concept1" placeholder="Ej. Pintura" required maxlength="20"/>
          <label for="price1">Valor:</label>
          <input class="rounded-lg" type="number" id="price1" name="price1" placeholder="Ej. 1000" required/>
          <label for="quantity1">Cantidad:</label>
          <input class="rounded-lg" type="number" id="quantity1" name="quantity1" placeholder="Ej. 1" required/>
        </div>
      </div>
    </div>
  </div>
  <div>

  </div>
  <div id="buttons" class="self-end flex flex-col gap-2 items-center">
    <div class="flex justify-center gap-10">
      <button id="generateItemButton" class="bg-blue-500 p-2 rounded-lg text-white shadow hover:shadow-black" type="button" onclick="generateItem()">Agregar trabajo</button>
      <button id="removeItemButton" class="bg-red-500 p-2 rounded-lg text-white shadow hover:shadow-black" type="button" onclick="removeItem()">Eliminar trabajo</button>
      <button id="generateInvoiceButton" type="submit" class="bg-green-400 p-2 rounded-lg shadow hover:shadow-black">Generar Factura</button>
    </div>
  </div>
</form>
{% endblock %}